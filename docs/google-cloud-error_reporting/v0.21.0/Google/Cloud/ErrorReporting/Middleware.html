---
layout: yard_main
title: "Class: Google::Cloud::ErrorReporting::Middleware - Documentation by YARD 0.9.18"
css: 
  - /docs/css/style.css
  - /docs/css/common.css
  - /css/yard-main.css
js: 
  - /docs/js/app.js
  - /js/yard-main.js
---
<script type="text/javascript" charset="utf-8">
  pathId = "Google::Cloud::ErrorReporting::Middleware";
  relpath = '../../../';
</script>


<div class="nav_wrap">
  <iframe id="nav" src="../../../class_list.html?1"></iframe>
  <div id="resizer"></div>
</div>

<div id="main" tabindex="-1">
  <div id="header">
    <div id="menu">
  
    <a href="../../../_index.html">Index (M)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../ErrorReporting.html" title="Google::Cloud::ErrorReporting (module)">ErrorReporting</a></span></span>
     &raquo; 
    <span class="title">Middleware</span>
  
</div>

    <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
    <div class="clear"></div>
  </div>

  <div id="content"><h1>Class: Google::Cloud::ErrorReporting::Middleware
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Google::Cloud::ErrorReporting::Middleware</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/google/cloud/error_reporting/middleware.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Middleware</p>

<p>Google::Cloud::ErrorReporting::Middleware defines a Rack Middleware
that can automatically catch upstream exceptions and report them
to Stackdriver Error Reporting.</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#error_reporting-instance_method" title="#error_reporting (instance method)">#<strong>error_reporting</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute error_reporting.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#ignore_classes-instance_method" title="#ignore_classes (instance method)">#<strong>ignore_classes</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute ignore_classes.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#project_id-instance_method" title="#project_id (instance method)">#<strong>project_id</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute project_id.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#service_name-instance_method" title="#service_name (instance method)">#<strong>service_name</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute service_name.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#service_version-instance_method" title="#service_version (instance method)">#<strong>service_version</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute service_version.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_error_event_from_exception-instance_method" title="#build_error_event_from_exception (instance method)">#<strong>build_error_event_from_exception</strong>(env, exception)  &#x21d2; Google::Devtools::Clouderrorreporting::V1beta1::ReportedErrorEvent </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a GRPC ErrorEvent based on the exception.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#call-instance_method" title="#call (instance method)">#<strong>call</strong>(env)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Implements the mandatory Rack Middleware call method.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#full_project_id-instance_method" title="#full_project_id (instance method)">#<strong>full_project_id</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Build full ReportErrorsServiceApi project_path from project_id, which is in &quot;projects/#<span class='object_link'><a href="#project_id-instance_method" title="Google::Cloud::ErrorReporting::Middleware#project_id (method)">#project_id</a></span>&quot; format.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(app, error_reporting: nil, project_id: nil, service_name: nil, service_version: nil, ignore_classes: nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Construct a new instance of Middleware.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#report_exception-instance_method" title="#report_exception (instance method)">#<strong>report_exception</strong>(env, exception)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Report an given exception to Stackdriver Error Reporting.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(app, error_reporting: nil, project_id: nil, service_name: nil, service_version: nil, ignore_classes: nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Construct a new instance of Middleware</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>app</span>
      
      
        <span class='type'>(<tt>Rack Application</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The Rack application</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>error_reporting</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="V1beta1/ReportErrorsServiceApi.html" title="Google::Cloud::ErrorReporting::V1beta1::ReportErrorsServiceApi (class)">Google::Cloud::ErrorReporting::V1beta1::ReportErrorsServiceApi</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A ErrorReporting::V1beta1::ReportErrorsServiceApi
object to for reporting exceptions</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>project_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Name of GCP project. Default to
ENV[&quot;ERROR_REPORTING_PROJECT&quot;] then ENV[&quot;GOOGLE_CLOUD_PROJECT&quot;].
Automatically discovered if on GAE</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Name of the service. Default to
ENV[&quot;ERROR_REPORTING_SERVICE&quot;] then &quot;ruby&quot;. Automatically discovered
if on GAE</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_version</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Version of the service. Optional.
ENV[&quot;ERROR_REPORTING_VERSION&quot;]. Automatically discovered if on GAE</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>ignore_classes</span>
      
      
        <span class='type'>(<tt>Array&lt;Class&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A single or an array of Exception
classes to ignore</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/error_reporting/middleware.rb', line 52</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span> <span class='id identifier rubyid_app'>app</span><span class='comma'>,</span> <span class='label'>error_reporting:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>project_id:</span> <span class='kw'>nil</span><span class='comma'>,</span>
               <span class='label'>service_name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>service_version:</span> <span class='kw'>nil</span><span class='comma'>,</span>
               <span class='label'>ignore_classes:</span> <span class='kw'>nil</span>
  <span class='ivar'>@app</span> <span class='op'>=</span> <span class='id identifier rubyid_app'>app</span>
  <span class='ivar'>@error_reporting</span> <span class='op'>=</span> <span class='id identifier rubyid_error_reporting'>error_reporting</span> <span class='op'>||</span>
    <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../ErrorReporting.html" title="Google::Cloud::ErrorReporting (module)">ErrorReporting</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="V1beta1.html" title="Google::Cloud::ErrorReporting::V1beta1 (module)">V1beta1</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="V1beta1/ReportErrorsServiceApi.html" title="Google::Cloud::ErrorReporting::V1beta1::ReportErrorsServiceApi (class)">ReportErrorsServiceApi</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="V1beta1/ReportErrorsServiceApi.html#initialize-instance_method" title="Google::Cloud::ErrorReporting::V1beta1::ReportErrorsServiceApi#initialize (method)">new</a></span></span>

  <span class='ivar'>@service_name</span> <span class='op'>=</span> <span class='id identifier rubyid_service_name'>service_name</span> <span class='op'>||</span>
                  <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR_REPORTING_SERVICE</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span>
                  <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>Core</span><span class='op'>::</span><span class='const'>Environment</span><span class='period'>.</span><span class='id identifier rubyid_gae_module_id'>gae_module_id</span> <span class='op'>||</span>
                  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ruby</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@service_version</span> <span class='op'>=</span> <span class='id identifier rubyid_service_version'>service_version</span> <span class='op'>||</span>
                     <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR_REPORTING_VERSION</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span>
                     <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>Core</span><span class='op'>::</span><span class='const'>Environment</span><span class='period'>.</span><span class='id identifier rubyid_gae_module_version'>gae_module_version</span>
  <span class='ivar'>@ignore_classes</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_ignore_classes'>ignore_classes</span><span class='rparen'>)</span>
  <span class='ivar'>@project_id</span> <span class='op'>=</span> <span class='id identifier rubyid_project_id'>project_id</span> <span class='op'>||</span>
                <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR_REPORTING_PROJECT</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span>
                <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GOOGLE_CLOUD_PROJECT</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span>
                <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>Core</span><span class='op'>::</span><span class='const'>Environment</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>project_id is required</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@project_id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="error_reporting-instance_method">
  
    #<strong>error_reporting</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute error_reporting</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/error_reporting/middleware.rb', line 29</span>

<span class='kw'>def</span> <span class='id identifier rubyid_error_reporting'>error_reporting</span>
  <span class='ivar'>@error_reporting</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="ignore_classes-instance_method">
  
    #<strong>ignore_classes</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute ignore_classes</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/error_reporting/middleware.rb', line 29</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ignore_classes'>ignore_classes</span>
  <span class='ivar'>@ignore_classes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="project_id-instance_method">
  
    #<strong>project_id</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute project_id</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/error_reporting/middleware.rb', line 29</span>

<span class='kw'>def</span> <span class='id identifier rubyid_project_id'>project_id</span>
  <span class='ivar'>@project_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="service_name-instance_method">
  
    #<strong>service_name</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute service_name</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/error_reporting/middleware.rb', line 29</span>

<span class='kw'>def</span> <span class='id identifier rubyid_service_name'>service_name</span>
  <span class='ivar'>@service_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="service_version-instance_method">
  
    #<strong>service_version</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute service_version</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/error_reporting/middleware.rb', line 29</span>

<span class='kw'>def</span> <span class='id identifier rubyid_service_version'>service_version</span>
  <span class='ivar'>@service_version</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="build_error_event_from_exception-instance_method">
  
    #<strong>build_error_event_from_exception</strong>(env, exception)  &#x21d2; <tt><span class='object_link'><a href="../../Devtools/Clouderrorreporting/V1beta1.html#ReportedErrorEvent-constant" title="Google::Devtools::Clouderrorreporting::V1beta1::ReportedErrorEvent (constant)">Google::Devtools::Clouderrorreporting::V1beta1::ReportedErrorEvent</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a GRPC ErrorEvent based on the exception. Fill in the
HttpRequestContext section of the ErrorEvent based on the HTTP Request
headers.</p>

<p>When used in Rails environment. It replies on
ActionDispatch::ExceptionWrapper class to derive a HTTP status code
based on the exception&#39;s class.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>env</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Rack environment hash</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>exception</span>
      
      
        <span class='type'>(<tt>Exception</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Exception to convert from</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Devtools/Clouderrorreporting/V1beta1.html#ReportedErrorEvent-constant" title="Google::Devtools::Clouderrorreporting::V1beta1::ReportedErrorEvent (constant)">Google::Devtools::Clouderrorreporting::V1beta1::ReportedErrorEvent</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The gRPC ReportedErrorEvent object that&#39;s based on given exception</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/error_reporting/middleware.rb', line 141</span>

<span class='kw'>def</span> <span class='id identifier rubyid_build_error_event_from_exception'>build_error_event_from_exception</span> <span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span>
  <span class='comment'># Build service_context hash
</span>  <span class='id identifier rubyid_service_context'>service_context</span> <span class='op'>=</span> <span class='lbrace'>{</span>
                      <span class='label'>service:</span> <span class='id identifier rubyid_service_name'>service_name</span><span class='comma'>,</span>
                      <span class='label'>version:</span> <span class='id identifier rubyid_service_version'>service_version</span>
                    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>

  <span class='comment'># Build error message and source_location hash
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
    <span class='id identifier rubyid_report_location'>report_location</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> \
              <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>)\n\t</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
              <span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_drop'>drop</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_file_path'>file_path</span><span class='comma'>,</span> <span class='id identifier rubyid_line_number'>line_number</span><span class='comma'>,</span> <span class='id identifier rubyid_function_name'>function_name</span> <span class='op'>=</span>
      <span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_function_name'>function_name</span> <span class='op'>=</span> <span class='id identifier rubyid_function_name'>function_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>`(.*)&#39;</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_report_location'>report_location</span> <span class='op'>=</span> <span class='lbrace'>{</span>
                        <span class='label'>file_path:</span> <span class='id identifier rubyid_file_path'>file_path</span><span class='comma'>,</span>
                        <span class='label'>function_name:</span> <span class='id identifier rubyid_function_name'>function_name</span><span class='comma'>,</span>
                        <span class='label'>line_number:</span> <span class='id identifier rubyid_line_number'>line_number</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
                      <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='comment'># Build http_request_context hash
</span>  <span class='id identifier rubyid_rack_request'>rack_request</span> <span class='op'>=</span> <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_env'>env</span>
  <span class='id identifier rubyid_http_method'>http_method</span> <span class='op'>=</span> <span class='id identifier rubyid_rack_request'>rack_request</span><span class='period'>.</span><span class='id identifier rubyid_request_method'>request_method</span>
  <span class='id identifier rubyid_http_url'>http_url</span> <span class='op'>=</span> <span class='id identifier rubyid_rack_request'>rack_request</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span>
  <span class='id identifier rubyid_http_user_agent'>http_user_agent</span> <span class='op'>=</span> <span class='id identifier rubyid_rack_request'>rack_request</span><span class='period'>.</span><span class='id identifier rubyid_user_agent'>user_agent</span>
  <span class='id identifier rubyid_http_referrer'>http_referrer</span> <span class='op'>=</span> <span class='id identifier rubyid_rack_request'>rack_request</span><span class='period'>.</span><span class='id identifier rubyid_referrer'>referrer</span>
  <span class='id identifier rubyid_http_status'>http_status</span> <span class='op'>=</span> <span class='id identifier rubyid_get_http_status'>get_http_status</span> <span class='id identifier rubyid_exception'>exception</span>
  <span class='id identifier rubyid_http_remote_ip'>http_remote_ip</span> <span class='op'>=</span> <span class='id identifier rubyid_rack_request'>rack_request</span><span class='period'>.</span><span class='id identifier rubyid_ip'>ip</span>
  <span class='id identifier rubyid_http_request_context'>http_request_context</span> <span class='op'>=</span> <span class='lbrace'>{</span>
                           <span class='label'>method:</span> <span class='id identifier rubyid_http_method'>http_method</span><span class='comma'>,</span>
                           <span class='label'>url:</span> <span class='id identifier rubyid_http_url'>http_url</span><span class='comma'>,</span>
                           <span class='label'>user_agent:</span> <span class='id identifier rubyid_http_user_agent'>http_user_agent</span><span class='comma'>,</span>
                           <span class='label'>referrer:</span> <span class='id identifier rubyid_http_referrer'>http_referrer</span><span class='comma'>,</span>
                           <span class='label'>response_status_code:</span> <span class='id identifier rubyid_http_status'>http_status</span><span class='comma'>,</span>
                           <span class='label'>remote_ip:</span> <span class='id identifier rubyid_http_remote_ip'>http_remote_ip</span>
                         <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>

  <span class='comment'># Build error_context hash
</span>  <span class='id identifier rubyid_error_context'>error_context</span> <span class='op'>=</span> <span class='lbrace'>{</span>
                    <span class='label'>http_request:</span> <span class='id identifier rubyid_http_request_context'>http_request_context</span><span class='comma'>,</span>
                    <span class='label'>user:</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>USER</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
                    <span class='label'>report_location:</span> <span class='id identifier rubyid_report_location'>report_location</span><span class='comma'>,</span>
                  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>

  <span class='comment'># Build error_event hash
</span>  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='id identifier rubyid_error_event'>error_event</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>event_time:</span> <span class='lbrace'>{</span>
      <span class='label'>seconds:</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span>
      <span class='label'>nanos:</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_nsec'>nsec</span>
    <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='label'>service_context:</span> <span class='id identifier rubyid_service_context'>service_context</span><span class='comma'>,</span>
    <span class='label'>message:</span> <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span>
    <span class='label'>context:</span> <span class='id identifier rubyid_error_context'>error_context</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>

  <span class='comment'># Finally build and return GRPC ErrorEvent
</span>  <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Devtools.html" title="Google::Devtools (module)">Devtools</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Devtools/Clouderrorreporting.html" title="Google::Devtools::Clouderrorreporting (module)">Clouderrorreporting</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Devtools/Clouderrorreporting/V1beta1.html" title="Google::Devtools::Clouderrorreporting::V1beta1 (module)">V1beta1</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Devtools/Clouderrorreporting/V1beta1.html#ReportedErrorEvent-constant" title="Google::Devtools::Clouderrorreporting::V1beta1::ReportedErrorEvent (constant)">ReportedErrorEvent</a></span></span><span class='period'>.</span><span class='id identifier rubyid_decode_json'>decode_json</span> \
    <span class='id identifier rubyid_error_event'>error_event</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="call-instance_method">
  
    #<strong>call</strong>(env)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Implements the mandatory Rack Middleware call method.</p>

<p>Catch all Exceptions from upstream and report them to Stackdriver
Error Reporting. Unless the exception&#39;s class is defined to be ignored
by this Middleware.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>env</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Rack environment hash</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/error_reporting/middleware.rb', line 84</span>

<span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span> <span class='id identifier rubyid_env'>env</span>
  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='ivar'>@app</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span> <span class='id identifier rubyid_env'>env</span>

  <span class='comment'># sinatra doesn&#39;t always raise the Exception, but it saves it in
</span>  <span class='comment'># env[&#39;sinatra.error&#39;]
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sinatra.error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Exception</span>
    <span class='id identifier rubyid_report_exception'>report_exception</span> <span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sinatra.error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_response'>response</span>
<span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_exception'>exception</span>
  <span class='id identifier rubyid_report_exception'>report_exception</span> <span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span>

  <span class='comment'># Always raise exception backup
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_exception'>exception</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="full_project_id-instance_method">
  
    #<strong>full_project_id</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Build full ReportErrorsServiceApi project_path from project_id, which
is in &quot;projects/#<span class='object_link'><a href="#project_id-instance_method" title="Google::Cloud::ErrorReporting::Middleware#project_id (method)">#project_id</a></span>&quot; format.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/error_reporting/middleware.rb', line 210</span>

<span class='kw'>def</span> <span class='id identifier rubyid_full_project_id'>full_project_id</span>
  <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../ErrorReporting.html" title="Google::Cloud::ErrorReporting (module)">ErrorReporting</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="V1beta1.html" title="Google::Cloud::ErrorReporting::V1beta1 (module)">V1beta1</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="V1beta1/ReportErrorsServiceApi.html" title="Google::Cloud::ErrorReporting::V1beta1::ReportErrorsServiceApi (class)">ReportErrorsServiceApi</a></span></span><span class='period'>.</span><span class='id identifier rubyid_project_path'><span class='object_link'><a href="V1beta1/ReportErrorsServiceApi.html#project_path-class_method" title="Google::Cloud::ErrorReporting::V1beta1::ReportErrorsServiceApi.project_path (method)">project_path</a></span></span> <span class='id identifier rubyid_project_id'>project_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="report_exception-instance_method">
  
    #<strong>report_exception</strong>(env, exception)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Report an given exception to Stackdriver Error Reporting.</p>

<p>While it reports most of the exceptions. Certain Rails exceptions that
maps to a HTTP status code less than 500 will be treated as not the
app fault and ignored.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>env</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Rack environment hash</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>exception</span>
      
      
        <span class='type'>(<tt>Exception</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The Ruby exception to report.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


111
112
113
114
115
116
117
118
119
120
121
122
123
124</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/error_reporting/middleware.rb', line 111</span>

<span class='kw'>def</span> <span class='id identifier rubyid_report_exception'>report_exception</span> <span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span>
  <span class='comment'># Do not any exceptions that&#39;s specified by the ignore_classes list.
</span>  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_ignore_classes'>ignore_classes</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span>

  <span class='id identifier rubyid_error_event'>error_event</span> <span class='op'>=</span> <span class='id identifier rubyid_build_error_event_from_exception'>build_error_event_from_exception</span> <span class='id identifier rubyid_env'>env</span><span class='comma'>,</span>
                                                 <span class='id identifier rubyid_exception'>exception</span>

  <span class='comment'># If this exception maps to a HTTP status code less than 500, do
</span>  <span class='comment'># not report it.
</span>  <span class='kw'>return</span> <span class='kw'>if</span>
    <span class='id identifier rubyid_error_event'>error_event</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_http_request'>http_request</span><span class='period'>.</span><span class='id identifier rubyid_response_status_code'>response_status_code</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>&lt;</span> <span class='int'>500</span>

  <span class='id identifier rubyid_error_reporting'>error_reporting</span><span class='period'>.</span><span class='id identifier rubyid_report_error_event'>report_error_event</span> <span class='id identifier rubyid_full_project_id'>full_project_id</span><span class='comma'>,</span> <span class='id identifier rubyid_error_event'>error_event</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

  <div id="footer">
  <ul class="footer-links">
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby" title="Google Cloud on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> GitHub
      </a>
    </li>
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby/issues" title="Google Cloud issues on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> Issues
      </a>
    </li>
    <li>
      <a href="http://stackoverflow.com/questions/tagged/google-cloud-ruby" title="Google Cloud on StackOverflow">
      <img src="/google-cloud-ruby/img/icon-link-stackoverflow.svg" alt="StackOverflow icon"> StackOverflow
    </a>
    </li>
    <li>
      <a href="http://rubygems.org/gems/google-cloud" title="Google Cloud on RubyGems">
        <img src="/google-cloud-ruby/img/icon-link-package-manager.svg" alt="RubyGems icon"> RubyGems
      </a>
    </li>
  </ul>

  <p>
    Documentation generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>.
  </p>
</div>

</div>
