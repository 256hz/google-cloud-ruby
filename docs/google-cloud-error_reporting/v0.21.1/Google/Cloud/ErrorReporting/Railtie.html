---
layout: yard_main
title: "Class: Google::Cloud::ErrorReporting::Railtie - Stackdriver"
css: 
  - /docs/css/style.css
  - /docs/css/common.css
  - /css/yard-main.css
js: 
  - /docs/js/app.js
  - /js/yard-main.js
---
<script type="text/javascript" charset="utf-8">
  pathId = "Google::Cloud::ErrorReporting::Railtie";
  relpath = '../../../';
</script>


<div class="nav_wrap">
  <iframe id="nav" src="../../../class_list.html?1"></iframe>
  <div id="resizer"></div>
</div>

<div id="main" tabindex="-1">
  <div id="header">
    <div id="menu">
  
    <a href="../../../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../ErrorReporting.html" title="Google::Cloud::ErrorReporting (module)">ErrorReporting</a></span></span>
     &raquo; 
    <span class="title">Railtie</span>
  
</div>

    <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
    <div class="clear"></div>
  </div>

  <div id="content"><h1>Class: Google::Cloud::ErrorReporting::Railtie
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Rails::Railtie</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Rails::Railtie</li>
          
            <li class="next">Google::Cloud::ErrorReporting::Railtie</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/google/cloud/error_reporting/rails.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Railtie</p>

<p>Google::Cloud::ErrorReporting::Railtie automatically add the
Google::Cloud::ErrorReporting::Middleware to Rack in a Rails environment.
It will automatically capture Exceptions from the Rails app and report
them to Stackdriver Error Reporting.</p>

<p>The Middleware is only added when certain conditions are met. See
<span class='object_link'><a href="#use_error_reporting%3F-class_method" title="Google::Cloud::ErrorReporting::Railtie.use_error_reporting? (method)">Railtie.use_error_reporting?</a></span> for detail.</p>

<p>When loaded, the Google::Cloud::ErrorReporting::Middleware will be
inserted after ::ActionDispatch::DebugExceptions Middleware, which allows
it to actually rescue all Exceptions and throw it back up. The middleware
should also be initialized with correct gcp project_id, keyfile,
service_name, and service_version if they are defined in
Rails environment files as follow:
  config.google_cloud.project_id = &quot;my-gcp-project&quot;
  config.google_cloud.keyfile = &quot;/path/to/secret.json&quot;
or
  config.google_cloud.error_reporting.project_id = &quot;my-gcp-project&quot;
  config.google_cloud.error_reporting.keyfile = &quot;/path/to/secret.json&quot;
  config.google_cloud.error_reporting.service_name = &quot;my-service-name&quot;
  config.google_cloud.error_reporting.service_version = &quot;v1&quot;</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#grpc_channel-class_method" title="grpc_channel (class method)">.<strong>grpc_channel</strong>(keyfile = nil)  &#x21d2; GRPC::Core::Channel </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Construct a gRPC Channel object from given keyfile.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#use_error_reporting%3F-class_method" title="use_error_reporting? (class method)">.<strong>use_error_reporting?</strong>(config)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Determine whether to use Stackdriver Error Reporting or not.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="grpc_channel-class_method">
  
    .<strong>grpc_channel</strong>(keyfile = nil)  &#x21d2; <tt>GRPC::Core::Channel</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Construct a gRPC Channel object from given keyfile</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>keyfile</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Keyfile downloaded from Google Cloud. If
file path the file must be readable.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>GRPC::Core::Channel</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>gRPC Channel object based on given
keyfile</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/error_reporting/rails.rb', line 99</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_grpc_channel'>grpc_channel</span> <span class='id identifier rubyid_keyfile'>keyfile</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>grpc</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_scopes'>scopes</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../ErrorReporting.html" title="Google::Cloud::ErrorReporting (module)">ErrorReporting</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="V1beta1.html" title="Google::Cloud::ErrorReporting::V1beta1 (module)">V1beta1</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="V1beta1/ReportErrorsServiceApi.html" title="Google::Cloud::ErrorReporting::V1beta1::ReportErrorsServiceApi (class)">ReportErrorsServiceApi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="V1beta1/ReportErrorsServiceApi.html#ALL_SCOPES-constant" title="Google::Cloud::ErrorReporting::V1beta1::ReportErrorsServiceApi::ALL_SCOPES (constant)">ALL_SCOPES</a></span></span>
  <span class='id identifier rubyid_credentials'>credentials</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_keyfile'>keyfile</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                  <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>Credentials</span><span class='period'>.</span><span class='id identifier rubyid_default'>default</span><span class='lparen'>(</span>
                    <span class='label'>scope:</span> <span class='id identifier rubyid_scopes'>scopes</span><span class='rparen'>)</span>
                <span class='kw'>else</span>
                  <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>Credentials</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
                    <span class='id identifier rubyid_keyfile'>keyfile</span><span class='comma'>,</span> <span class='label'>scope:</span> <span class='id identifier rubyid_scopes'>scopes</span><span class='rparen'>)</span>
                <span class='kw'>end</span>

  <span class='comment'># Return nil if :this_channel_is_insecure
</span>  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_credentials'>credentials</span> <span class='op'>==</span> <span class='symbol'>:this_channel_is_insecure</span>

  <span class='id identifier rubyid_channel_cred'>channel_cred</span> <span class='op'>=</span> <span class='const'>GRPC</span><span class='op'>::</span><span class='const'>Core</span><span class='op'>::</span><span class='const'>ChannelCredentials</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_compose'>compose</span> \
    <span class='const'>GRPC</span><span class='op'>::</span><span class='const'>Core</span><span class='op'>::</span><span class='const'>CallCredentials</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_updater_proc'>updater_proc</span>
  <span class='id identifier rubyid_host'>host</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../ErrorReporting.html" title="Google::Cloud::ErrorReporting (module)">ErrorReporting</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="V1beta1.html" title="Google::Cloud::ErrorReporting::V1beta1 (module)">V1beta1</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="V1beta1/ReportErrorsServiceApi.html" title="Google::Cloud::ErrorReporting::V1beta1::ReportErrorsServiceApi (class)">ReportErrorsServiceApi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="V1beta1/ReportErrorsServiceApi.html#SERVICE_ADDRESS-constant" title="Google::Cloud::ErrorReporting::V1beta1::ReportErrorsServiceApi::SERVICE_ADDRESS (constant)">SERVICE_ADDRESS</a></span></span>

  <span class='const'>GRPC</span><span class='op'>::</span><span class='const'>Core</span><span class='op'>::</span><span class='const'>Channel</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_channel_cred'>channel_cred</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="use_error_reporting?-class_method">
  
    .<strong>use_error_reporting?</strong>(config)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Determine whether to use Stackdriver Error Reporting or not.</p>

<p>Returns true if valid GCP project_id and keyfile are provided and
either Rails is in &quot;production&quot; environment or \
config.google_cloud.use_error_reporting is explicitly true. Otherwise
false.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>config</span>
      
      
        <span class='type'>(<tt>Rails::Railtie::Configuration</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The
Rails.application.config</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Whether to use Stackdriver Error Reporting</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/error_reporting/rails.rb', line 134</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_use_error_reporting?'>use_error_reporting?</span> <span class='id identifier rubyid_config'>config</span>
  <span class='id identifier rubyid_gcp_config'>gcp_config</span> <span class='op'>=</span> <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_google_cloud'>google_cloud</span>
  <span class='id identifier rubyid_er_config'>er_config</span> <span class='op'>=</span> <span class='id identifier rubyid_gcp_config'>gcp_config</span><span class='period'>.</span><span class='id identifier rubyid_error_reporting'>error_reporting</span>

  <span class='comment'># Return false if config.google_cloud.use_error_reporting is
</span>  <span class='comment'># explicitly false
</span>  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_gcp_config'>gcp_config</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='symbol'>:use_error_reporting</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
                  <span class='op'>!</span><span class='id identifier rubyid_gcp_config'>gcp_config</span><span class='period'>.</span><span class='id identifier rubyid_use_error_reporting'>use_error_reporting</span>

  <span class='comment'># Check credentialing. Returns false if authorization errors are
</span>  <span class='comment'># rescued.
</span>  <span class='id identifier rubyid_keyfile'>keyfile</span> <span class='op'>=</span> <span class='id identifier rubyid_er_config'>er_config</span><span class='period'>.</span><span class='id identifier rubyid_keyfile'>keyfile</span> <span class='op'>||</span> <span class='id identifier rubyid_gcp_config'>gcp_config</span><span class='period'>.</span><span class='id identifier rubyid_keyfile'>keyfile</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_grpc_channel'>grpc_channel</span> <span class='id identifier rubyid_keyfile'>keyfile</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Google::Cloud::ErrorReporting is not </span><span class='tstring_end'>&quot;</span></span> \
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>activated due to authorization error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_project_id'>project_id</span> <span class='op'>=</span> <span class='id identifier rubyid_er_config'>er_config</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span> <span class='op'>||</span>
               <span class='id identifier rubyid_gcp_config'>gcp_config</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span> <span class='op'>||</span>
               <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR_REPORTING_PROJECT</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span>
               <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GOOGLE_CLOUD_PROJECT</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span>
               <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>Core</span><span class='op'>::</span><span class='const'>Environment</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_project_id'>project_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Google::Cloud::ErrorReporting is not </span><span class='tstring_end'>&quot;</span></span> \
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>activated due to empty project_id</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># Otherwise return true if Rails is running in production or
</span>  <span class='comment'># config.google_cloud.use_error_reporting is explicitly true
</span>  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='period'>.</span><span class='id identifier rubyid_production?'>production?</span> <span class='op'>||</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_gcp_config'>gcp_config</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='symbol'>:use_error_reporting</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
      <span class='id identifier rubyid_gcp_config'>gcp_config</span><span class='period'>.</span><span class='id identifier rubyid_use_error_reporting'>use_error_reporting</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

  <div id="footer">
  <ul class="footer-links">
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby" title="Google Cloud on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> GitHub
      </a>
    </li>
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby/issues" title="Google Cloud issues on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> Issues
      </a>
    </li>
    <li>
      <a href="http://stackoverflow.com/questions/tagged/google-cloud-ruby" title="Google Cloud on StackOverflow">
      <img src="/google-cloud-ruby/img/icon-link-stackoverflow.svg" alt="StackOverflow icon"> StackOverflow
    </a>
    </li>
    <li>
      <a href="http://rubygems.org/gems/google-cloud" title="Google Cloud on RubyGems">
        <img src="/google-cloud-ruby/img/icon-link-package-manager.svg" alt="RubyGems icon"> RubyGems
      </a>
    </li>
  </ul>

  <p>
    Documentation generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>.
  </p>
</div>

</div>
